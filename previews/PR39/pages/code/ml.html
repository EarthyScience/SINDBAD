<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SINDBAD</title>
    <meta name="description" content="A model-data integration framework for terrestrial ecosystem processes">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/SINDBAD/previews/PR39/assets/style.CJtGtx3D.css" as="style">
    <link rel="preload stylesheet" href="/SINDBAD/previews/PR39/vp-icons.css" as="style">
    
    <script type="module" src="/SINDBAD/previews/PR39/assets/app.F0cpO_wg.js"></script>
    <link rel="preload" href="/SINDBAD/previews/PR39/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/SINDBAD/previews/PR39/assets/chunks/theme.BvfIaR6d.js">
    <link rel="modulepreload" href="/SINDBAD/previews/PR39/assets/chunks/framework.D3f5R3mD.js">
    <link rel="modulepreload" href="/SINDBAD/previews/PR39/assets/pages_code_ml.md.OXzimdUy.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-492508fc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-492508fc>Skip to content</a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-0f4f798b><a class="title" href="/SINDBAD/previews/PR39/" data-v-0f4f798b><!--[--><!--]--><!--[--><img class="VPImage logo" src="/SINDBAD/previews/PR39/sindbad_logo.png" width="24" height="24" alt data-v-35a7d0b8><!--]--><span data-v-0f4f798b>SINDBAD</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Concept</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/concept/overview.html" data-v-acbfed09><!--[--><span data-v-acbfed09>SINDBAD</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/concept/experiment.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Experiment</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/concept/TEM.html" data-v-acbfed09><!--[--><span data-v-acbfed09>TEM</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/concept/info.html" data-v-acbfed09><!--[--><span data-v-acbfed09>info</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/concept/land.html" data-v-acbfed09><!--[--><span data-v-acbfed09>land</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Settings</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/settings/overview.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Overview</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/settings/experiment.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Experiments</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/settings/forcing.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Forcing</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/settings/model_structure.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Models</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/settings/optimization.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Optimization</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/settings/parameters.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Parameters</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Code</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/overview.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Sindbad</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/sindbad.html" data-v-acbfed09><!--[--><span data-v-acbfed09> + Core</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/models.html" data-v-acbfed09><!--[--><span data-v-acbfed09>   ++ Models</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/types.html" data-v-acbfed09><!--[--><span data-v-acbfed09>   ++ Types</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/utilities.html" data-v-acbfed09><!--[--><span data-v-acbfed09>   ++ Utilities</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/metrics.html" data-v-acbfed09><!--[--><span data-v-acbfed09>   ++ Metrics</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/data.html" data-v-acbfed09><!--[--><span data-v-acbfed09> + Data</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link active" href="/SINDBAD/previews/PR39/pages/code/ml.html" data-v-acbfed09><!--[--><span data-v-acbfed09> + ML</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/optimization.html" data-v-acbfed09><!--[--><span data-v-acbfed09> + Optimization</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/setup.html" data-v-acbfed09><!--[--><span data-v-acbfed09> + Setup</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/code/tem.html" data-v-acbfed09><!--[--><span data-v-acbfed09> + TEM</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Develop</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/overview.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Overview</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/install.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Install</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/conventions.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Modeling Convention</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/model_approach.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Model/Approach</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/sindbad_types.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Sindbad Types</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/array_handling.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Array Handling</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/land_utils.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Land Utils</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/experiments.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Experiments</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/sindbad_outputs.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Experiment Outputs</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/spinup.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Spinup</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/hybrid_modeling.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Hybrid ML</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/optimization_method.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Optimization Methods</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/cost_metrics.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Cost Metrics</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/cost_function.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Cost Function</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/how_to_doc.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Documentation</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/develop/helpers.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Useful Helpers</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>About</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/about/contact.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Contact</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/about/license.html" data-v-acbfed09><!--[--><span data-v-acbfed09>License</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/about/publications.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Publications</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/about/support.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Support</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/SINDBAD/previews/PR39/pages/about/team.html" data-v-acbfed09><!--[--><span data-v-acbfed09>Team</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><!----><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/EarthyScience/SINDBAD" aria-label="repo address" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-04f5c5e9><span class="vpi-more-horizontal icon" data-v-04f5c5e9></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/EarthyScience/SINDBAD" aria-label="repo address" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--[--><!--[--><div class="VPFlyout VPNolebaseEnhancedReadabilitiesMenu VPNolebaseEnhancedReadabilitiesMenuFlyout" aria-label="Enhanced Readability" role="menuitem" data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><span class="i-icon-park-outline:book-open option-icon" data-v-04f5c5e9></span><!----><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--]--></div></div></div><!--]--><!--]--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-168ddf5d><button data-v-168ddf5d>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Concept</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/concept/overview.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>SINDBAD</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/concept/experiment.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Experiment</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/concept/TEM.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>TEM</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/concept/info.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>info</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/concept/land.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>land</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Develop</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/overview.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/install.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Install</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/conventions.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Modeling Convention</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/model_approach.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Model/Approach</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/sindbad_types.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Sindbad Types</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/array_handling.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Array Handling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/land_utils.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Land Utils</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/experiments.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Experiments</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/sindbad_outputs.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Experiment Outputs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/spinup.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Spinup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/hybrid_modeling.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Hybrid ML</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/optimization_method.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Optimization Methods</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/cost_metrics.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Cost Metrics</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/cost_function.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Cost Function</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/how_to_doc.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Documentation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/develop/helpers.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Useful Helpers</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Settings</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/settings/overview.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/settings/experiment.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Experiments</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/settings/forcing.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Forcing</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/settings/model_structure.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Models</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/settings/optimization.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Optimization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/settings/parameters.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Parameters</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Code</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/overview.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Sindbad</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/sindbad.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf> + Core</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/models.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>   ++ Models</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/types.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>   ++ Types</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/utilities.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>   ++ Utilities</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/metrics.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>   ++ Metrics</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/data.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf> + Data</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/ml.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf> + ML</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/optimization.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf> + Optimization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/setup.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf> + Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/code/tem.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf> + TEM</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>About</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/about/contact.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Contact</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/about/license.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>License</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/about/publications.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Publications</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/about/support.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Support</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/SINDBAD/previews/PR39/pages/about/team.html" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Team</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _SINDBAD_previews_PR39_pages_code_ml" data-v-83890dd9><div><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML" href="#Sindbad.ML"><span class="jlbinding">Sindbad.ML</span></a> <span class="VPBadge info jlObjectType jlModule"><!--[-->Module<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ML</span></span></code></pre></div><p>The <code>ML</code> package provides the core functionality for integrating machine learning (ML) and hybrid modeling capabilities into the SINDBAD framework. It enables the use of neural networks and other ML models alongside process-based models for parameter learning, and potentially hybrid modeling, and advanced optimization.</p><p><strong>Purpose</strong></p><p>This package brings together all components required for hybrid (process-based + ML) modeling in SINDBAD, including data preparation, model construction, training routines, gradient computation, and optimizer management. It supports flexible configuration, cross-validation, and seamless integration with SINDBAD&#39;s process-based modeling workflows.</p><p><strong>Dependencies</strong></p><ul><li><p><code>Distributed</code>: Parallel and distributed computing utilities (<code>nworkers</code>, <code>pmap</code>, <code>workers</code>, <code>nprocs</code>, <code>CachingPool</code>).</p></li><li><p><code>Sindbad</code>, <code>SindbadTEM</code>, <code>SindbadSetup</code>: Core SINDBAD modules for process-based modeling and setup.</p></li><li><p><code>SindbadData.YAXArrays</code>, <code>SindbadData.Zarr</code>, <code>SindbadData.AxisKeys</code>, <code>SindbadData</code>: Data handling, array, and cube utilities.</p></li><li><p><code>SindbadCore.Metrics</code>: Metrics for model performance/loss evaluation.</p></li><li><p><code>PolyesterForwardDiff</code>, <code>Enzyme</code>, <code>Zygote</code>, <code>ForwardDiff</code>, <code>FiniteDiff</code>, <code>FiniteDifferences</code>: Automatic and numerical differentiation libraries for gradient-based learning. (Defaults will be Zygote and PolyesterForwardDiff for performance. All others should come as extensions.)</p></li><li><p><code>Flux</code>: Neural network layers and training utilities for ML models.</p></li><li><p><code>Optimisers</code>: Optimizers for training neural networks.</p></li><li><p><code>Statistics</code>: Statistical utilities.</p></li><li><p><code>ProgressMeter</code>: Progress bars for ML training and evaluation (<code>@showprogress</code>, <code>Progress</code>, <code>next!</code>, <code>progress_pmap</code>, <code>progress_map</code>).</p></li><li><p><code>PreallocationTools</code>: Tools for efficient memory allocation.</p></li><li><p><code>Base.Iterators</code>: Iterators for batching and repetition (<code>repeated</code>, <code>partition</code>).</p></li><li><p><code>Random</code>: Random number utilities.</p></li><li><p><code>JLD2</code>: For saving and loading model checkpoints and fold indices.</p></li></ul><p><strong>Included Files</strong></p><ul><li><p><code>utilsML.jl</code>: Utility functions for ML workflows.</p></li><li><p><code>diffCaches.jl</code>: Caching utilities for differentiation.</p></li><li><p><code>activationFunctions.jl</code>: Implements various activation functions, including custom and Flux-provided activations.</p></li><li><p><code>mlModels.jl</code>: Constructors and utilities for building neural network models and other ML architectures.</p></li><li><p><code>mlOptimizers.jl</code>: Functions for creating and configuring optimizers for ML training.</p></li><li><p><code>loss.jl</code>: Loss functions and utilities for evaluating model performance and computing gradients.</p></li><li><p><code>prepHybrid.jl</code>: Prepares all data structures, loss functions, and ML components required for hybrid modeling, including data splits and feature extraction.</p></li><li><p><code>mlGradient.jl</code>: Routines for computing gradients using different libraries and methods, supporting both automatic and finite difference differentiation.</p></li><li><p><code>mlTrain.jl</code>: Training routines for ML and hybrid models, including batching, checkpointing, and evaluation.</p></li><li><p><code>neuralNetwork.jl</code>: Neural network utilities and architectures.</p></li><li><p><code>siteLosses.jl</code>: Site-specific loss calculation utilities.</p></li><li><p><code>oneHots.jl</code>: One-hot encoding utilities.</p></li><li><p><code>loadCovariates.jl</code>: Functions for loading and handling covariate data.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>The package is modular and extensible, allowing users to add new ML models, optimizers, activation functions, and training methods.</p></li><li><p>It is tightly integrated with the SINDBAD ecosystem, ensuring consistent data handling and reproducibility across hybrid and process-based modeling workflows.</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/ML.jl#L1-L42" target="_blank" rel="noreferrer">source</a><!--]--></span></details><h2 id="Exported" tabindex="-1">Exported <a class="header-anchor" href="#Exported" aria-label="Permalink to &quot;Exported {#Exported}&quot;">​</a></h2><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.JoinDenseNN-Tuple{Tuple}" href="#Sindbad.ML.JoinDenseNN-Tuple{Tuple}"><span class="jlbinding">Sindbad.ML.JoinDenseNN</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JoinDenseNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(models</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Tuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Arguments:</strong></p><ul><li>models :: a tuple of models, i.e. (m1, m2)</li></ul><p><strong>Returns:</strong></p><ul><li>all parameters as a vector or matrix (multiple samples)</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SindbadML</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flux</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Random</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Random</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">seed!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m_big </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Chain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, relu), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sigmoid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m_eta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sigmoid)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x_big_a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x_small_a1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x_small_a2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JoinDenseNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((m_big, m_eta))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((x_big_a, x_small_a2))</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/neuralNetwork.jl#L68-L95" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.activationFunction" href="#Sindbad.ML.activationFunction"><span class="jlbinding">Sindbad.ML.activationFunction</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">activationFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_options, act</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractActivation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Return the activation function corresponding to the specified activation type and model options.</p><p>This function dispatches on the activation type to provide the appropriate activation function for use in neural network layers. For custom activation types, relevant parameters can be passed via <code>model_options</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>model_options</code>: A struct or NamedTuple containing model options, including parameters for custom activation functions (e.g., <code>k_σ</code> for <code>CustomSigmoid</code>).</p></li><li><p><code>act</code>: An activation type specifying the desired activation function. Supported types include:</p><ul><li><p><code>FluxRelu</code>: Rectified Linear Unit (ReLU) activation.</p></li><li><p><code>FluxTanh</code>: Hyperbolic Tangent (tanh) activation.</p></li><li><p><code>FluxSigmoid</code>: Sigmoid activation.</p></li><li><p><code>CustomSigmoid</code>: Custom sigmoid activation with steepness parameter <code>k_σ</code>.</p></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>A callable activation function suitable for use in neural network layers.</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">act_fn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> activationFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_options, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FluxRelu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> act_fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/activationFunctions.jl#L3-L26" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.denseNN-Tuple{Int64, Int64, Int64}" href="#Sindbad.ML.denseNN-Tuple{Int64, Int64, Int64}"><span class="jlbinding">Sindbad.ML.denseNN</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">denseNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in_dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, n_neurons</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, out_dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; extra_hlayers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, activation_hidden</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">relu, activation_out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sigmoid, seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1618</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>in_dim</code>: input dimension</p></li><li><p><code>n_neurons</code>: number of neurons in each hidden layer</p></li><li><p><code>out_dim</code>: output dimension</p></li><li><p><code>extra_hlayers</code>=0: controls the number of extra hidden layers, default is <code>zero</code></p></li><li><p><code>activation_hidden</code>=Flux.relu: activation function within hidden layers, default is Relu</p></li><li><p><code>activation_out</code>= Flux.sigmoid: activation of output layer, default is sigmoid</p></li><li><p><code>seed=1618</code>: Random seed, default is ~ (1+√5)/2</p></li></ul><p>Returns a <code>Flux.Chain</code> neural network.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/neuralNetwork.jl#L7-L20" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.destructureNN-Tuple{Any}" href="#Sindbad.ML.destructureNN-Tuple{Any}"><span class="jlbinding">Sindbad.ML.destructureNN</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">destructureNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model; nn_opt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Optimisers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Adam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><p>Given a <code>model</code> returns a <code>flat</code> vector with all weights, a <code>re</code> structure of the neural network and the current <code>state</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>model</code>: a Flux.Chain neural network.</p></li><li><p><code>nn_opt</code>: Optimiser, the default is <code>Optimisers.Adam()</code>.</p></li></ul><p>Returns:</p><ul><li><p>flat :: a flat vector with all network weights</p></li><li><p>re :: an object containing the model structure, used later to <code>re</code>construct the neural network</p></li><li><p>opt_state :: the state of the optimiser</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/neuralNetwork.jl#L33-L46" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.epochLossComponents-Union{Tuple{F}, Tuple{F, Vararg{Any, 5}}} where F" href="#Sindbad.ML.epochLossComponents-Union{Tuple{F}, Tuple{F, Vararg{Any, 5}}} where F"><span class="jlbinding">Sindbad.ML.epochLossComponents</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">epochLossComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loss_functions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_array_sites, loss_array_components, epoch_number, scaled_params, sites_list) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {F}</span></span></code></pre></div><p>Compute and store the loss metrics and loss components for each site in parallel for a given training epoch.</p><p>This function evaluates the provided loss functions for each site using the current scaled parameters, and stores the resulting scalar loss metrics and loss component vectors in the corresponding arrays for the specified epoch. Parallel execution is used to accelerate computation across sites.</p><p><strong>Arguments</strong></p><ul><li><p><code>loss_functions::F</code>: An array or KeyedArray of loss functions, one per site (where <code>F</code> is a subtype of <code>AbstractArray{&lt;:Function}</code>).</p></li><li><p><code>loss_array_sites</code>: A matrix to store the scalar loss metric for each site and epoch (dimensions: site × epoch).</p></li><li><p><code>loss_array_components</code>: A 3D tensor to store the loss components for each site, component, and epoch (dimensions: site × component × epoch).</p></li><li><p><code>epoch_number</code>: The current epoch number (integer).</p></li><li><p><code>scaled_params</code>: A callable or array providing the scaled parameters for each site (e.g., <code>scaled_params(site=site_name)</code>).</p></li><li><p><code>sites_list</code>: List or array of site identifiers to process.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>The function uses Julia&#39;s threading (<code>Threads.@spawn</code>) to compute losses for multiple sites in parallel.</p></li><li><p>Each site&#39;s loss metric and components are stored at the corresponding index for the current epoch.</p></li><li><p>Designed for use within training loops to track loss evolution over epochs.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">epochLossComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loss_functions, loss_array_sites, loss_array_components, epoch, scaled_params, sites)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/loss.jl#L107-L131" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getCacheFromOutput" href="#Sindbad.ML.getCacheFromOutput"><span class="jlbinding">Sindbad.ML.getCacheFromOutput</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getCacheFromOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loc_output, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MLGradType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getCacheFromOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loc_output, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ForwardDiffGrad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getCacheFromOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loc_output, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PolyesterForwardDiffGrad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Returns the appropriate Cache type based on the automatic differentiation or finite differences package being used.</p><p><strong>Arguments</strong></p><ul><li><p><code>loc_output</code>: The local output</p></li><li><p>Second argument specifies the differentiation method:</p><ul><li><p><code>ForwardDiffGrad</code>: Uses ForwardDiff.jl for automatic differentiation</p></li><li><p><code>MLGradType</code>: All other libraries, e.g., FiniteDiff.jl,FiniteDifferences.jl, etc. for gradient calculations</p></li><li><p><code>PolyesterForwardDiffGrad</code>: Uses PolyesterForwardDiff.jl for automatic differentiation</p></li></ul></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/diffCaches.jl#L16-L30" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getIndicesSplit" href="#Sindbad.ML.getIndicesSplit"><span class="jlbinding">Sindbad.ML.getIndicesSplit</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getIndicesSplit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(info, sites, fold_type)</span></span></code></pre></div><p>Determine the indices for training, validation, and testing site splits for hybrid (ML) modeling in SINDBAD.</p><p>This function dispatches on the <code>fold_type</code> argument to either load precomputed folds from file or to compute the splits on-the-fly based on the provided split ratios and number of folds.</p><p><strong>Arguments</strong></p><ul><li><p><code>info</code>: The SINDBAD experiment info structure, containing hybrid modeling configuration.</p></li><li><p><code>sites</code>: Array of site identifiers (e.g., site names or indices).</p></li><li><p><code>fold_type</code>: Determines the splitting strategy. Use <code>LoadFoldFromFile()</code> to load folds from file, or <code>CalcFoldFromSplit()</code> to compute splits dynamically.</p></li></ul><p><strong>Returns</strong></p><ul><li><p><code>indices_training</code>: Indices of sites assigned to the training set.</p></li><li><p><code>indices_validation</code>: Indices of sites assigned to the validation set.</p></li><li><p><code>indices_testing</code>: Indices of sites assigned to the testing set.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>When using <code>LoadFoldFromFile</code>, the function loads fold indices from the file specified in <code>info.hybrid.fold.fold_path</code>.</p></li><li><p>When using <code>CalcFoldFromSplit</code>, the function splits the sites according to the ratios and number of folds specified in <code>info.hybrid.ml_training.options</code>.</p></li><li><p>Ensures reproducibility by using the random seed from <code>info.hybrid.random_seed</code> when shuffling sites.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">indices_train, indices_val, indices_test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getIndicesSplit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(info, sites, info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hybrid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fold_type)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/prepHybrid.jl#L3-L29" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getInnerArgs-NTuple{17, Any}" href="#Sindbad.ML.getInnerArgs-NTuple{17, Any}"><span class="jlbinding">Sindbad.ML.getInnerArgs</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getInnerArgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(idx, grads_lib, scaled_params_batch, parameter_scaling_type, selected_models, space_forcing, space_spinup_forcing, loc_forcing_t, space_output, loc_land, tem_info, parameter_to_index, parameter_scaling_type, space_observations, cost_options, constraint_method, indices_batch, sites_batch)</span></span></code></pre></div><p>Function to get inner arguments for the loss function.</p><p><strong>Arguments</strong></p><ul><li><p><code>idx</code>: index batch value</p></li><li><p><code>grads_lib</code>: gradient library</p></li><li><p><code>scaled_params_batch</code>: scaled parameters batch</p></li><li><p><code>selected_models</code>: selected models</p></li><li><p><code>space_forcing</code>: forcing data location</p></li><li><p><code>space_spinup_forcing</code>: spinup forcing data location</p></li><li><p><code>loc_forcing_t</code>: forcing data time for one time step.</p></li><li><p><code>space_output</code>: output data location</p></li><li><p><code>loc_land</code>: initial land state</p></li><li><p><code>tem_info</code>: model information</p></li><li><p><code>parameter_to_index</code>: parameter to index</p></li><li><p><code>parameter_scaling_type</code>: type determining parameter scaling</p></li><li><p><code>loc_observations</code>: observation data location</p></li><li><p><code>cost_options</code>: cost options</p></li><li><p><code>constraint_method</code>: constraint method</p></li><li><p><code>indices_batch</code>: indices batch</p></li><li><p><code>sites_batch</code>: sites batch</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/siteLosses.jl#L125-L148" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getLossForSites-Union{Tuple{F}, Tuple{Any, F, Vararg{Any, 18}}} where F" href="#Sindbad.ML.getLossForSites-Union{Tuple{F}, Tuple{Any, F, Vararg{Any, 18}}} where F"><span class="jlbinding">Sindbad.ML.getLossForSites</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getLossForSites</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gradient_lib, loss_function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_array_sites, loss_array_split, epoch_number, scaled_params, sites_list, indices_sites, models, space_forcing, space_spinup_forcing, loc_forcing_t, space_output, loc_land, tem_info, parameter_to_index, parameter_scaling_type, space_observations, cost_options, constraint_method) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {F}</span></span></code></pre></div><p>Calculates the loss for all sites. The loss is calculated using the <code>loss_function</code> function. The <code>loss_array_sites</code> and <code>loss_array_split</code> arrays are updated with the loss values. The <code>loss_array_sites</code> array stores the loss values for each site and epoch, while the <code>loss_array_split</code> array stores the loss values for each model output and epoch.</p><p><strong>Arguments</strong></p><ul><li><p><code>gradient_lib</code>: gradient library</p></li><li><p><code>loss_function</code>: loss function</p></li><li><p><code>loss_array_sites</code>: array to store the loss values for each site and epoch</p></li><li><p><code>loss_array_split</code>: array to store the loss values for each model output and epoch</p></li><li><p><code>epoch_number</code>: epoch number</p></li><li><p><code>scaled_params</code>: scaled parameters</p></li><li><p><code>sites_list</code>: list of sites</p></li><li><p><code>indices_sites</code>: indices of sites</p></li><li><p><code>models</code>: list of models</p></li><li><p><code>space_forcing</code>: forcing data location</p></li><li><p><code>space_spinup_forcing</code>: spinup forcing data location</p></li><li><p><code>loc_forcing_t</code>: forcing data time for one time step.</p></li><li><p><code>space_output</code>: output data location</p></li><li><p><code>loc_land</code>: initial land state</p></li><li><p><code>tem_info</code>: model information</p></li><li><p><code>parameter_to_index</code>: parameter to index</p></li><li><p><code>space_observations</code>: observation data location</p></li><li><p><code>cost_options</code>: cost options</p></li><li><p><code>constraint_method</code>: constraint method</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/siteLosses.jl#L72-L97" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getLossFunctionHandles-Tuple{Any, Any, Any}" href="#Sindbad.ML.getLossFunctionHandles-Tuple{Any, Any, Any}"><span class="jlbinding">Sindbad.ML.getLossFunctionHandles</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getLossFunctionHandles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(info, run_helpers, sites)</span></span></code></pre></div><p>Construct loss function handles for each site for use in hybrid (ML) modeling in SINDBAD.</p><p>This function generates callable loss functions and loss component functions for each site, encapsulating all necessary arguments and configuration from the experiment <code>info</code> and runtime helpers. These handles are used during training and evaluation to compute the loss and its components for each site efficiently.</p><p><strong>Arguments</strong></p><ul><li><p><code>info</code>: The SINDBAD experiment info structure, containing model, optimization, and hybrid configuration.</p></li><li><p><code>run_helpers</code>: Helper object returned by <code>prepTEM</code>, containing prepared model, forcing, observation, and output structures.</p></li><li><p><code>sites</code>: Array of site indices or identifiers for which to build loss functions.</p></li></ul><p><strong>Returns</strong></p><ul><li><p><code>loss_functions</code>: A <code>KeyedArray</code> of callable loss functions, one per site. Each function takes model parameters as input and returns the scalar loss for that site.</p></li><li><p><code>loss_component_functions</code>: A <code>KeyedArray</code> of callable functions, one per site, that return the vector of loss components (e.g., for multi-objective or constraint-based loss).</p></li></ul><p><strong>Notes</strong></p><ul><li><p>Each loss function is closed over all required data and options for its site, including model structure, parameter indices, scaling, forcing, observations, output cache, cost options, and hybrid/optimization settings.</p></li><li><p>The returned arrays are keyed by site for convenient lookup and iteration.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loss_functions, loss_component_functions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getLossFunctionHandles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(info, run_helpers, sites)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">site_loss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loss_functions[site_index](params)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">site_loss_components </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loss_component_functions[site_index](params)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/prepHybrid.jl#L118-L144" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getOutputFromCache" href="#Sindbad.ML.getOutputFromCache"><span class="jlbinding">Sindbad.ML.getOutputFromCache</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getOutputFromCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loc_output, _, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MLGradType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getOutputFromCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loc_output, new_params, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ForwardDiffGrad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getOutputFromCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loc_output, new_params, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PolyesterForwardDiffGrad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Retrieves output values from <code>Cache</code> based on the differentiation method being used.</p><p><strong>Arguments</strong></p><ul><li><p><code>loc_output</code>: The cached output values</p></li><li><p><code>_</code> or <code>new_params</code>: Additional parameters (only used with ForwardDiff)</p></li><li><p>Third argument specifies the differentiation method:</p><ul><li><p><code>MLGradType</code>: Returns cached output directly when using other libraries, e.g., FiniteDiff.jl, FiniteDifferences.jl, etc.</p></li><li><p><code>ForwardDiffGrad</code>: Processes cached output with new parameters when using ForwardDiff.jl, returns <code>get_tmp.(loc_output, (new_params,))</code></p></li><li><p><code>PolyesterForwardDiffGrad</code>: Calls cached output with new parameters using ForwardDiff.jl</p></li></ul></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/diffCaches.jl#L47-L62" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getParamsAct-Tuple{Any, Any}" href="#Sindbad.ML.getParamsAct-Tuple{Any, Any}"><span class="jlbinding">Sindbad.ML.getParamsAct</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getParamsAct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, parameter_table)</span></span></code></pre></div><p>Scales <code>x</code> values in the [0,1] interval to some given lower <code>lo_b</code> and upper <code>up_b</code> bounds.</p><p><strong>Arguments</strong></p><ul><li><p><code>x</code>: vector array</p></li><li><p><code>parameter_table</code>: a Table with input fields <code>default</code>, <code>lower</code> and <code>upper</code> that match the <code>x</code> vector.</p></li></ul><p>Returns a vector array with new values scaled into the new interval <code>[lower, upper]</code>.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/utilsML.jl#L7-L17" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getPullback" href="#Sindbad.ML.getPullback"><span class="jlbinding">Sindbad.ML.getPullback</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getPullback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flat, re, features</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getPullback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flat, re, features</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Tuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Arguments:</strong></p><ul><li><p>flat :: weight parameters.</p></li><li><p>re :: model structure (vanilla Chain Dense Layers).</p></li><li><p>features :: <code>n</code> predictors and <code>s</code> samples.</p><ul><li><p>A vector of predictors</p></li><li><p>A matrix of predictors: <code>(p_n x s)</code></p></li><li><p>A tuple vector of predictors: <code>(p1, p2)</code></p></li><li><p>A tuple of matrices of predictors: <code>[(p1_n x s), (p2_n x s)]</code></p></li></ul></li></ul><p><strong>Returns:</strong></p><ul><li>new parameters and pullback function</li></ul><p><strong>Example</strong></p><p>Here we do one input features vector or matrix.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SindbadML</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flux</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Chain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, relu), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sigmoid)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># features</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_feat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># apply</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flat, re </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> destructureNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Zygote</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_params, pullback_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getPullback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flat, re, _feat)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ? or</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_feat_ns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># `n` predictors and `s` samples.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_params, pullback_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getPullback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flat, re, _feat_ns)</span></span></code></pre></div><p><strong>Example</strong></p><p>Here we do one multiple input features vector or matrix.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SindbadML</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flux</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Chain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, relu), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sigmoid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dense</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Flux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sigmoid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">combo_ms </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JoinDenseNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((m1, m2))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># features</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_feat1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_feat2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># apply</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flat, re </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> destructureNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(combo_ms)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Zygote</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_params, pullback_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getPullback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flat, re, (_feat1, _feat2))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ? or with multiple samples</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_feat1_ns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># `n` predictors and `s` samples.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_feat2_ns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># `n` predictors and `s` samples.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_params, pullback_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getPullback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flat, re, (_feat1_ns, _feat2_ns))</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/neuralNetwork.jl#L119-L178" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.gradientBatch!" href="#Sindbad.ML.gradientBatch!"><span class="jlbinding">Sindbad.ML.gradientBatch!</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradientBatch!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, grads_batch, chunk_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, get_inner_args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, input_args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; showprog</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradientBatch!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, grads_batch, gradient_options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_functions, scaled_params_batch, sites_batch; showprog</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Compute gradients for a batch of samples in hybrid (ML) modeling in SINDBAD.</p><p>This function computes the gradients of the loss function with respect to model parameters for a batch of sites or samples, using the specified gradient library. It supports both distributed and multi-threaded execution, and can handle different gradient computation backends (e.g., <code>PolyesterForwardDiff</code>, <code>ForwardDiff</code>, <code>FiniteDiff</code>, etc.).</p><p><strong>Arguments</strong></p><ul><li><p><code>grads_lib</code>: Gradient computation library or method. Supported types include:</p><ul><li><p><code>PolyesterForwardDiffGrad</code>: Uses <code>PolyesterForwardDiff.jl</code> for multi-threaded chunked gradients.</p></li><li><p>Other <code>MLGradType</code> subtypes: Use their respective backend.</p></li></ul></li><li><p><code>grads_batch</code>: Pre-allocated array for storing batched gradients (size: n_parameters × n_samples).</p></li><li><p><code>chunk_size</code>: (Optional) Chunk size for threaded gradient computation (used by <code>PolyesterForwardDiffGrad</code>).</p></li><li><p><code>gradient_options</code>: (Optional) NamedTuple of gradient options (e.g., chunk size).</p></li><li><p><code>loss_f</code>: Loss function to be applied (for all samples).</p></li><li><p><code>get_inner_args</code>: Function to obtain inner arguments for the loss function.</p></li><li><p><code>input_args</code>: Global input arguments for the batch.</p></li><li><p><code>loss_functions</code>: Array or KeyedArray of loss functions, one per site.</p></li><li><p><code>scaled_params_batch</code>: Callable or array providing scaled parameters for each site.</p></li><li><p><code>sites_batch</code>: List or array of site identifiers for the batch.</p></li><li><p><code>showprog</code>: (Optional) If <code>true</code>, display a progress bar during computation (default: <code>false</code>).</p></li></ul><p><strong>Returns</strong></p><ul><li>Updates <code>grads_batch</code> in-place with computed gradients for each sample in the batch.</li></ul><p><strong>Notes</strong></p><ul><li><p>The function automatically selects between distributed (<code>pmap</code>) and multi-threaded (<code>Threads.@spawn</code>) execution depending on the backend and arguments.</p></li><li><p>Designed for use within training loops for efficient batch gradient computation.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradientBatch!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, grads_batch, (chunk_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,), loss_functions, scaled_params_batch, sites_batch; showprog</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlGradient.jl#L177-L211" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.gradientSite" href="#Sindbad.ML.gradientSite"><span class="jlbinding">Sindbad.ML.gradientSite</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradientSite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, x_vals, chunk_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradientSite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, x_vals, gradient_options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradientSite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, x_vals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, gradient_options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loss_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Compute gradients of the loss function with respect to model parameters for a single site using the specified gradient library.</p><p>This function dispatches on the type of <code>grads_lib</code> to select the appropriate differentiation backend (e.g., <code>PolyesterForwardDiff</code>, <code>ForwardDiff</code>, <code>FiniteDiff</code>, <code>FiniteDifferences</code>, <code>Zygote</code>, or <code>Enzyme</code>). It supports both threaded and single-threaded computation, as well as chunked evaluation for memory and speed trade-offs.</p><p><strong>Arguments</strong></p><ul><li><p><code>grads_lib</code>: Gradient computation library or method. Supported types include:</p><ul><li><p><code>PolyesterForwardDiffGrad</code>: Uses <code>PolyesterForwardDiff.jl</code> for multi-threaded chunked gradients.</p></li><li><p><code>ForwardDiffGrad</code>: Uses <code>ForwardDiff.jl</code> for automatic differentiation.</p></li><li><p><code>FiniteDiffGrad</code>: Uses <code>FiniteDiff.jl</code> for finite difference gradients.</p></li><li><p><code>FiniteDifferencesGrad</code>: Uses <code>FiniteDifferences.jl</code> for finite difference gradients.</p></li><li><p><code>ZygoteGrad</code>: Uses <code>Zygote.jl</code> for reverse-mode automatic differentiation.</p></li><li><p><code>EnzymeGrad</code>: Uses <code>Enzyme.jl</code> for AD (experimental).</p></li></ul></li><li><p><code>x_vals</code>: Parameter values for which to compute gradients.</p></li><li><p><code>chunk_size</code>: (Optional) Chunk size for threaded gradient computation (used by <code>PolyesterForwardDiffGrad</code>).</p></li><li><p><code>gradient_options</code>: (Optional) NamedTuple of gradient options (e.g., chunk size).</p></li><li><p><code>loss_f</code>: Loss function to be differentiated.</p></li><li><p><code>args...</code>: Additional arguments to be passed to the loss function.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>∇x</code>: Array of gradients of the loss function with respect to <code>x_vals</code>.</li></ul><p><strong>Notes</strong></p><ul><li><p>On Apple M1 systems, <code>PolyesterForwardDiffGrad</code> falls back to single-threaded <code>ForwardDiff</code> due to closure issues.</p></li><li><p>The function is used internally for both site-level and batch-level gradient computation in hybrid ML training.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">grads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gradientSite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ForwardDiffGrad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), x_vals, (chunk_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,), loss_f)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlGradient.jl#L98-L132" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.gradsNaNCheck!-NTuple{4, Any}" href="#Sindbad.ML.gradsNaNCheck!-NTuple{4, Any}"><span class="jlbinding">Sindbad.ML.gradsNaNCheck!</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gradsNaNCheck!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_batch, _params_batch, sites_batch, parameter_table; show_params_for_nan</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Utility function to check if some calculated gradients were NaN (if found please double check your approach). This function will replace those NaNs with 0.0f0.</p><p><strong>Arguments</strong></p><ul><li><p><code>grads_batch</code>: gradients array.</p></li><li><p><code>_params_batch</code>: parameters values.</p></li><li><p><code>sites_batch</code>: sites names.</p></li><li><p><code>parameter_table</code>: parameters table.</p></li><li><p><code>show_params_for_nan=false</code>: if true, it will show the parameters that caused the NaNs.</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlGradient.jl#L260-L272" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.lcKAoneHotbatch-NTuple{4, Any}" href="#Sindbad.ML.lcKAoneHotbatch-NTuple{4, Any}"><span class="jlbinding">Sindbad.ML.lcKAoneHotbatch</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lcKAoneHotbatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lc_data, up_bound, lc_name, ka_labels)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>lc_data</code>: Vector array</p></li><li><p><code>up_bound</code>: last index class, the range goes from <code>1:up_bound</code>, and any case not in that range uses the <code>up_bound</code> value. For <code>PFT</code> use <code>17</code> and for <code>KG</code> <code>32</code>.</p></li><li><p><code>lc_name</code>: land cover approach, either <code>KG</code> or <code>PFT</code>.</p></li><li><p><code>ka_labels</code>: KeyedArray labels, i.e. site names</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/oneHots.jl#L97-L105" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.loadCovariates-Tuple{Any}" href="#Sindbad.ML.loadCovariates-Tuple{Any}"><span class="jlbinding">Sindbad.ML.loadCovariates</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">loadCovariates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sites_forcing; kind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;all&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>use the <code>kind</code> argument to select different sets of covariates</p><p><strong>Arguments</strong></p><ul><li><p>sites_forcing: names of forcing sites</p></li><li><p>kind: defaults to &quot;all&quot;</p></li></ul><p>Other options</p><ul><li><p><code>PFT</code></p></li><li><p><code>KG</code></p></li><li><p><code>KG_PFT</code></p></li><li><p><code>PFT_ABCNOPSWB</code></p></li><li><p><code>KG_ABCNOPSWB</code></p></li><li><p><code>ABCNOPSWB</code></p></li><li><p><code>veg_all</code></p></li><li><p><code>veg</code></p></li><li><p><code>KG_veg</code></p></li><li><p><code>veg_ABCNOPSWB</code></p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/loadCovariates.jl#L3-L23" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.loadTrainedNN-Tuple{Any}" href="#Sindbad.ML.loadTrainedNN-Tuple{Any}"><span class="jlbinding">Sindbad.ML.loadTrainedNN</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">loadTrainedNN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(path_model)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><code>path_model</code>: path to the model.</li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlGradient.jl#L289-L294" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.loss-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, LossModelObsML}" href="#Sindbad.ML.loss-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, LossModelObsML}"><span class="jlbinding">Sindbad.ML.loss</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">loss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params, models, parameter_to_index, parameter_scaling_type, loc_forcing, loc_spinup_forcing, loc_forcing_t, loc_output, land_init, tem_info, loc_obs, cost_options, constraint_method, gradient_lib, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LossModelObsML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Calculates the scalar loss for a given site in hybrid (ML) modeling in SINDBAD.</p><p>This function computes the loss value for a given site by first calling <code>lossVector</code> to obtain the vector of loss components, and then combining them into a scalar loss using the <code>combineMetric</code> function and the specified constraint method.</p><p><strong>Arguments</strong></p><ul><li><p><code>params</code>: Model parameters (typically output from an ML model).</p></li><li><p><code>models</code>: List of process-based models.</p></li><li><p><code>parameter_to_index</code>: Mapping from parameter names to indices.</p></li><li><p><code>parameter_scaling_type</code>: Parameter scaling configuration.</p></li><li><p><code>loc_forcing</code>: Forcing data for the site.</p></li><li><p><code>loc_spinup_forcing</code>: Spinup forcing data for the site.</p></li><li><p><code>loc_forcing_t</code>: Forcing data for a single time step.</p></li><li><p><code>loc_output</code>: Output data structure for the site.</p></li><li><p><code>land_init</code>: Initial land state.</p></li><li><p><code>tem_info</code>: Model information and configuration.</p></li><li><p><code>loc_obs</code>: Observation data for the site.</p></li><li><p><code>cost_options</code>: Cost function and metric configuration.</p></li><li><p><code>constraint_method</code>: Constraint method for combining metrics.</p></li><li><p><code>gradient_lib</code>: Gradient computation library or method.</p></li><li><p><code>::LossModelObsML</code>: Type dispatch for loss model with observations and machine learning.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>t_loss</code>: Scalar loss value for the site.</li></ul><p><strong>Notes</strong></p><ul><li><p>This function is used internally by higher-level training and evaluation routines.</p></li><li><p>The loss is computed by aggregating the loss vector using the specified constraint method.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t_loss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> loss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params, models, parameter_to_index, parameter_scaling_type, loc_forcing, loc_spinup_forcing, loc_forcing_t, loc_output, land_init, tem_info, loc_obs, cost_options, constraint_method, gradient_lib, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LossModelObsML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/loss.jl#L59-L94" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.lossSite-NTuple{14, Any}" href="#Sindbad.ML.lossSite-NTuple{14, Any}"><span class="jlbinding">Sindbad.ML.lossSite</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lossSite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(new_params, gradient_lib, models, loc_forcing, loc_spinup_forcing, loc_forcing_t, loc_output, land_init, tem_info, parameter_to_index, parameter_scaling_type, loc_obs, cost_options, constraint_method; optim_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Function to calculate the loss for a given site. This is used for optimization, hence the <code>optim_mode</code> argument is set to <code>true</code> by default. Also, a gradient library should be set as well as new parameters to update the models. See all input arguments in the function:</p><p><strong>Arguments</strong></p><ul><li><p><code>new_params</code>: new parameters</p></li><li><p><code>gradient_lib</code>: gradient library</p></li><li><p><code>models</code>: list of models</p></li><li><p><code>loc_forcing</code>: forcing data location</p></li><li><p><code>loc_spinup_forcing</code>: spinup forcing data location</p></li><li><p><code>loc_forcing_t</code>: forcing data time for one time step.</p></li><li><p><code>loc_output</code>: output data location</p></li><li><p><code>land_init</code>: initial land state</p></li><li><p><code>tem_info</code>: model information</p></li><li><p><code>parameter_to_index</code>: parameter to index</p></li><li><p><code>loc_obs</code>: observation data location</p></li><li><p><code>cost_options</code>: cost options</p></li><li><p><code>constraint_method</code>: constraint method</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/siteLosses.jl#L43-L62" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.lossVector-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, LossModelObsML}" href="#Sindbad.ML.lossVector-Tuple{Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, Any, LossModelObsML}"><span class="jlbinding">Sindbad.ML.lossVector</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lossVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params, models, parameter_to_index, parameter_scaling_type, loc_forcing, loc_spinup_forcing, loc_forcing_t, loc_output, land_init, tem_info, loc_obs, cost_options, constraint_method, gradient_lib, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LossModelObsML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Calculate the loss vector for a given site in hybrid (ML) modeling in SINDBAD.</p><p>This function runs the core TEM model with the provided parameters, forcing data, initial land state, and model information, then computes the loss vector using the specified cost options and metrics. It is typically used for site-level loss evaluation during training and validation.</p><p><strong>Arguments</strong></p><ul><li><p><code>params</code>: Model parameters (in this case, output from an ML model).</p></li><li><p><code>models</code>: List of process-based models.</p></li><li><p><code>parameter_to_index</code>: Mapping from parameter names to indices.</p></li><li><p><code>parameter_scaling_type</code>: Parameter scaling configuration.</p></li><li><p><code>loc_forcing</code>: Forcing data for the site.</p></li><li><p><code>loc_spinup_forcing</code>: Spinup forcing data for the site.</p></li><li><p><code>loc_forcing_t</code>: Forcing data for a single time step.</p></li><li><p><code>loc_output</code>: Output data structure for the site.</p></li><li><p><code>land_init</code>: Initial land state.</p></li><li><p><code>tem_info</code>: Model information and configuration.</p></li><li><p><code>loc_obs</code>: Observation data for the site.</p></li><li><p><code>cost_options</code>: Cost function and metric configuration.</p></li><li><p><code>constraint_method</code>: Constraint method for combining metrics.</p></li><li><p><code>gradient_lib</code>: Gradient computation library or method.</p></li><li><p><code>::LossModelObsML</code>: Type dispatch for loss model with observations and machine learning.</p></li></ul><p><strong>Returns</strong></p><ul><li><p><code>loss_vector</code>: Vector of loss components for the site.</p></li><li><p><code>loss_indices</code>: Indices corresponding to each loss component.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>This function is used internally by higher-level loss and training routines.</p></li><li><p>The loss vector is typically combined into a scalar loss using <code>combineMetric</code>.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loss_vec, loss_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> lossVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params, models, parameter_to_index, parameter_scaling_type, loc_forcing, loc_spinup_forcing, loc_forcing_t, loc_output, land_init, tem_info, loc_obs, cost_options, constraint_method, gradient_lib, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LossModelObsML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/loss.jl#L6-L42" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.mixedGradientTraining-NTuple{7, Any}" href="#Sindbad.ML.mixedGradientTraining-NTuple{7, Any}"><span class="jlbinding">Sindbad.ML.mixedGradientTraining</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mixedGradientTraining</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grads_lib, nn_model, train_refs, test_val_refs, loss_fargs, forward_args; n_epochs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, optimizer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Optimisers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Adam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), path_experiment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Training function that computes model parameters using a neural network, which are then used by process-based models (PBMs) to estimate parameter gradients. Neural network weights are updated using the product of these gradients with the neural network&#39;s Jacobian.</p><p><strong>Arguments</strong></p><ul><li><p><code>grads_lib</code>: Library to compute PBMs parameter gradients.</p></li><li><p><code>nn_model</code>: A <code>Flux.Chain</code> neural network.</p></li><li><p><code>train_refs</code>: training data features.</p></li><li><p><code>test_val_refs</code>: test and validation data features.</p></li><li><p><code>loss_fargs</code>: functions used to calculate the loss.</p></li><li><p><code>forward_args</code>: arguments to evaluate the PBMs.</p></li><li><p><code>path_experiment=&quot;/&quot;</code>: save model to path.</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlGradient.jl#L7-L21" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.mlModel" href="#Sindbad.ML.mlModel"><span class="jlbinding">Sindbad.ML.mlModel</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mlModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(info, n_features, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MLModelType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds a Flux dense neural network model. This function initializes a neural network model based on the provided <code>info</code> and <code>n_features</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>info</code>: The experiment information containing model options and parameters.</p></li><li><p><code>n_features</code>: The number of features in the input data.</p></li><li><p><code>::MLModelType</code>: Type dispatch for the machine learning model type.</p></li></ul><p><strong>Supported MLModelType:</strong></p><ul><li><code>::FluxDenseNN</code>: A simple dense neural network model implemented in Flux.jl.</li></ul><p><strong>Returns</strong></p><p>The initialized machine learning model.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlModels.jl#L4-L19" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.mlOptimizer" href="#Sindbad.ML.mlOptimizer"><span class="jlbinding">Sindbad.ML.mlOptimizer</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mlOptimizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(optimizer_options, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MLOptimizerType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Create a ML optimizer from the given options and type. The optimizer is created using the given options and type. The options are passed to the constructor of the optimizer.</p><p><strong>Arguments:</strong></p><ul><li><p><code>optimizer_options</code>: A dictionary or NamedTuple containing options for the optimizer.</p></li><li><p><code>::MLOptimizerType</code>: The type used to determine which optimizer to create. Supported types include:</p><ul><li><p><code>OptimisersAdam</code>: For Adam optimizer.</p></li><li><p><code>OptimisersDescent</code>: For Descent optimizer.</p></li></ul></li></ul><p>.</p><p><strong>Returns:</strong></p><ul><li>A ML optimizer object that can be used to optimize machine learning models.</li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlOptimizers.jl#L3-L17" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.oneHotPFT-Tuple{Any, Any, Any}" href="#Sindbad.ML.oneHotPFT-Tuple{Any, Any, Any}"><span class="jlbinding">Sindbad.ML.oneHotPFT</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">oneHotPFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pft, up_bound, veg_class)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>pft</code>: (Plant Functional Type). Any entry not in 1:17 would be set to the last index, this includes NaN! Last index is water/NaN</p></li><li><p><code>up_bound</code>: last index class, the range goes from <code>1:up_bound</code>, and any case not in that range uses the <code>up_bound</code> value. For <code>PFT</code> use <code>17</code>.</p></li><li><p><code>veg_class</code>: <code>true</code> or <code>false</code>.</p></li></ul><p>Returns a vector.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/oneHots.jl#L75-L84" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.partitionBatches-Tuple{Any}" href="#Sindbad.ML.partitionBatches-Tuple{Any}"><span class="jlbinding">Sindbad.ML.partitionBatches</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">partitionBatches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(n; batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Return an Iterator partitioning a dataset into batches.</p><p><strong>Arguments</strong></p><ul><li><p><code>n</code>: number of samples</p></li><li><p><code>batch_size</code>: batch size</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/utilsML.jl#L39-L47" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.prepHybrid-Tuple{Any, Any, Any, MLTrainingType}" href="#Sindbad.ML.prepHybrid-Tuple{Any, Any, Any, MLTrainingType}"><span class="jlbinding">Sindbad.ML.prepHybrid</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prepHybrid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(forcing, observations, info, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MLTrainingType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Prepare all data structures, loss functions, and machine learning components required for hybrid (process-based + machine learning) modeling in SINDBAD.</p><p>This function orchestrates the setup for hybrid modeling by:</p><ul><li><p>Initializing model helpers and runtime structures.</p></li><li><p>Building loss function handles for each site.</p></li><li><p>Splitting sites into training, validation, and testing sets according to the hybrid configuration.</p></li><li><p>Loading covariate features for all sites.</p></li><li><p>Building the machine learning model as specified in the configuration.</p></li><li><p>Preparing arrays for storing losses and loss components during training and evaluation.</p></li><li><p>Initializing the optimizer for ML training.</p></li><li><p>Collecting all relevant metadata and configuration into a single <code>hybrid_helpers</code> NamedTuple for downstream training routines.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>forcing</code>: Forcing data structure as required by the process-based model.</p></li><li><p><code>observations</code>: Observational data structure.</p></li><li><p><code>info</code>: The SINDBAD experiment info structure, containing all configuration and runtime options.</p></li><li><p><code>::MLTrainingType</code>: Type specifying the ML training method to use (e.g., <code>MixedGradient</code>).</p></li></ul><p><strong>Returns</strong></p><ul><li><code>hybrid_helpers</code>: A NamedTuple containing all prepared data, models, loss functions, indices, features, optimizers, and arrays needed for hybrid ML training and evaluation.</li></ul><p><strong>Fields of <code>hybrid_helpers</code></strong></p><ul><li><p><code>run_helpers</code>: Output of <code>prepTEM</code>, containing prepared model, forcing, observation, and output structures.</p></li><li><p><code>sites</code>: NamedTuple with <code>training</code>, <code>validation</code>, and <code>testing</code> site arrays.</p></li><li><p><code>indices</code>: NamedTuple with indices for <code>training</code>, <code>validation</code>, and <code>testing</code> sites.</p></li><li><p><code>features</code>: NamedTuple with <code>n_features</code> and <code>data</code> (covariate features for all sites).</p></li><li><p><code>ml_model</code>: The machine learning model instance (e.g., a Flux neural network).</p></li><li><p><code>options</code>: The <code>info.hybrid</code> configuration NamedTuple.</p></li><li><p><code>checkpoint_path</code>: Path for saving checkpoints during training.</p></li><li><p><code>parameter_table</code>: Parameter table from <code>info.optimization</code>.</p></li><li><p><code>loss_functions</code>: KeyedArray of callable loss functions, one per site.</p></li><li><p><code>loss_component_functions</code>: KeyedArray of callable loss component functions, one per site.</p></li><li><p><code>training_optimizer</code>: The optimizer object for ML training.</p></li><li><p><code>loss_array</code>: NamedTuple of arrays to store scalar losses for training, validation, and testing.</p></li><li><p><code>loss_array_components</code>: NamedTuple of arrays to store loss components for training, validation, and testing.</p></li><li><p><code>metadata_global</code>: Global metadata from the output configuration.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>This function is typically called once at the start of a hybrid modeling experiment to set up all necessary components.</p></li><li><p>The returned <code>hybrid_helpers</code> is designed to be passed directly to training routines such as <code>trainML</code>.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hybrid_helpers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prepHybrid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(forcing, observations, info, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MixedGradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trainML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hybrid_helpers, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MixedGradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/prepHybrid.jl#L168-L217" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.shuffleBatches-Tuple{Any, Any}" href="#Sindbad.ML.shuffleBatches-Tuple{Any, Any}"><span class="jlbinding">Sindbad.ML.shuffleBatches</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shuffleBatches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(list, bs; seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>bs</code>: Batch size</p></li><li><p><code>list</code>: an array of samples</p></li><li><p><code>seed</code>: Int</p></li></ul><p>Returns shuffled partitioned batches.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/utilsML.jl#L67-L77" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.shuffleList-Tuple{Any}" href="#Sindbad.ML.shuffleList-Tuple{Any}"><span class="jlbinding">Sindbad.ML.shuffleList</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">shuffleList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(list; seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>list</code>: an array of samples</p></li><li><p><code>seed</code>: Int</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/utilsML.jl#L85-L91" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.siteNameToID-Tuple{Any, Any}" href="#Sindbad.ML.siteNameToID-Tuple{Any, Any}"><span class="jlbinding">Sindbad.ML.siteNameToID</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">siteNameToID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(site_name, sites_list)</span></span></code></pre></div><p>Returns the index of <code>site_name</code> in the <code>sites_list</code></p><p><strong>Arguments</strong></p><ul><li><p><code>site_name</code>: site name</p></li><li><p><code>sites_list</code>: list of site names</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/utilsML.jl#L53-L61" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.toClass-Tuple{Number}" href="#Sindbad.ML.toClass-Tuple{Number}"><span class="jlbinding">Sindbad.ML.toClass</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">toClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; vegetation_rules)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>x</code>: a key <code>(Number)</code> from <code>vegetation_rules</code></p></li><li><p><code>vegetation_rules</code></p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/oneHots.jl#L34-L40" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.trainML-Tuple{Any, MixedGradient}" href="#Sindbad.ML.trainML-Tuple{Any, MixedGradient}"><span class="jlbinding">Sindbad.ML.trainML</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trainML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hybrid_helpers, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MLTrainingType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Train a machine learning (ML) or hybrid model in SINDBAD using the specified training method.</p><p>This function performs the training loop for the ML model, handling batching, gradient computation, optimizer updates, loss calculation, and checkpointing. It supports hybrid modeling workflows where ML-derived parameters are used in process-based models, and is designed to work with the data structures prepared by <code>prepHybrid</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>hybrid_helpers</code>: NamedTuple containing all prepared data, models, loss functions, indices, features, optimizers, and arrays needed for ML training and evaluation (as returned by <code>prepHybrid</code>).</p></li><li><p><code>::MLTrainingType</code>: Type specifying the ML training method to use (e.g., <code>MixedGradient</code>).</p></li></ul><p><strong>Workflow</strong></p><ul><li><p>Iterates over epochs and batches of training sites.</p></li><li><p>For each batch:</p><ul><li><p>Extracts features and computes model parameters.</p></li><li><p>Computes gradients using the specified gradient method.</p></li><li><p>Checks for NaNs in gradients and replaces them if needed.</p></li><li><p>Updates model parameters using the optimizer.</p></li></ul></li><li><p>After each epoch:</p><ul><li><p>Computes and stores losses and loss components for training, validation, and testing sets.</p></li><li><p>Saves model checkpoints and loss arrays to disk if a checkpoint path is specified.</p></li></ul></li></ul><p><strong>Notes</strong></p><ul><li><p>The function is extensible to support different training strategies via dispatch on <code>MLTrainingType</code>.</p></li><li><p>Designed for use with hybrid modeling, where ML models provide parameters to process-based models.</p></li><li><p>Checkpointing enables resuming or analyzing training progress.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hybrid_helpers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prepHybrid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(forcing, observations, info, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MixedGradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trainML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hybrid_helpers, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MixedGradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlTrain.jl#L3-L35" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.vegKAoneHotbatch-Tuple{Any, Any}" href="#Sindbad.ML.vegKAoneHotbatch-Tuple{Any, Any}"><span class="jlbinding">Sindbad.ML.vegKAoneHotbatch</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">vegKAoneHotbatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pft_data, ka_labels)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>pft_data</code>: Vector array</p></li><li><p><code>ka_labels</code>: KeyedArray labels, i.e. site names</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/oneHots.jl#L117-L123" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.vegOneHot-Tuple{Any}" href="#Sindbad.ML.vegOneHot-Tuple{Any}"><span class="jlbinding">Sindbad.ML.vegOneHot</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">vegOneHot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(v_class; vegetation_labels)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p><code>v_class</code>: get it by doing <code>toClass(x; vegetation_rules)</code>.</p></li><li><p><code>vegetation_labels</code>: see them by typing <code>vegetation_labels</code>.</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/oneHots.jl#L63-L69" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.vegOneHotbatch-Tuple{Any}" href="#Sindbad.ML.vegOneHotbatch-Tuple{Any}"><span class="jlbinding">Sindbad.ML.vegOneHotbatch</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">vegOneHotbatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(veg_classes; vegetation_labels)</span></span></code></pre></div><p><strong>Arguments</strong></p><ul><li><p>veg_classes: get these from <code>toClass.([x1, x2,...])</code></p></li><li><p>vegetation_labels: see them by typing <code>vegetation_labels</code></p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/oneHots.jl#L52-L58" target="_blank" rel="noreferrer">source</a><!--]--></span></details><h2 id="Internal" tabindex="-1">Internal <a class="header-anchor" href="#Internal" aria-label="Permalink to &quot;Internal {#Internal}&quot;">​</a></h2><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.batchShuffler-Tuple{Any, Any, Any}" href="#Sindbad.ML.batchShuffler-Tuple{Any, Any, Any}"><span class="jlbinding">Sindbad.ML.batchShuffler</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">batchShuffler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x_forcings, ids_forcings, batch_size; bs_seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1456</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Shuffles the batches of forcings and their corresponding indices.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/mlGradient.jl#L85-L89" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getLoss-NTuple{10, Any}" href="#Sindbad.ML.getLoss-NTuple{10, Any}"><span class="jlbinding">Sindbad.ML.getLoss</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getLoss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(models, loc_forcing, loc_spinup_forcing, loc_forcing_t, loc_output, land_init, tem_info, loc_obs, cost_options, constraint_method; optim_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Calculates the loss for a given site. At this stage model parameters should had been set. The loss is calculated using the <code>metricVector</code> and <code>combineMetric</code> functions. The <code>metricVector</code> function calculates the loss for each model output and the <code>combineMetric</code> function combines the losses into a single value.</p><p><strong>Arguments</strong></p><ul><li><p><code>models</code>: list of models</p></li><li><p><code>loc_forcing</code>: forcing data location</p></li><li><p><code>loc_spinup_forcing</code>: spinup forcing data location</p></li><li><p><code>loc_forcing_t</code>: forcing data time for one time step.</p></li><li><p><code>loc_output</code>: output data location</p></li><li><p><code>land_init</code>: initial land state</p></li><li><p><code>tem_info</code>: model information</p></li><li><p><code>loc_obs</code>: observation data location</p></li><li><p><code>cost_options</code>: cost options</p></li><li><p><code>constraint_method</code>: constraint method</p></li></ul><p>The optional argument <code>optim_mode</code> is used to return the loss value only when set to <code>true</code>. Otherwise, it returns the loss value, the loss vector, and the loss indices.</p><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/siteLosses.jl#L5-L23" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.getNFolds-NTuple{6, Any}" href="#Sindbad.ML.getNFolds-NTuple{6, Any}"><span class="jlbinding">Sindbad.ML.getNFolds</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getNFolds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sites, train_ratio, val_ratio, test_ratio, n_folds, batch_size; seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1234</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Partition a list of sites into training, validation, and testing sets for k-fold cross-validation in hybrid (ML) modeling.</p><p>This function shuffles the input <code>sites</code> array using the provided random <code>seed</code> for reproducibility, then splits the sites into <code>n_folds</code> folds. It computes the number of sites for each partition based on the provided ratios, ensuring the training set size is a multiple of <code>batch_size</code>. The function returns the indices for training, validation, and testing sets, as well as the full list of folds.</p><p><strong>Arguments</strong></p><ul><li><p><code>sites</code>: Array of site identifiers (e.g., site names or indices).</p></li><li><p><code>train_ratio</code>: Fraction of sites to assign to the training set.</p></li><li><p><code>val_ratio</code>: Fraction of sites to assign to the validation set.</p></li><li><p><code>test_ratio</code>: Fraction of sites to assign to the testing set.</p></li><li><p><code>n_folds</code>: Number of folds for cross-validation.</p></li><li><p><code>batch_size</code>: Batch size for training; training set size will be rounded down to a multiple of this value.</p></li><li><p><code>seed</code>: (Optional) Random seed for reproducibility (default: 1234).</p></li></ul><p><strong>Returns</strong></p><ul><li><p><code>train_indices</code>: Array of sites assigned to the training set.</p></li><li><p><code>val_indices</code>: Array of sites assigned to the validation set.</p></li><li><p><code>test_indices</code>: Array of sites assigned to the testing set.</p></li><li><p><code>folds</code>: Vector of arrays, each containing the sites for one fold.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>The sum of <code>train_ratio</code>, <code>val_ratio</code>, and <code>test_ratio</code> must be approximately 1.0.</p></li><li><p>The returned <code>folds</code> can be used for further cross-validation or analysis.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">train_indices, val_indices, test_indices, folds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getNFolds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sites, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/prepHybrid.jl#L56-L86" target="_blank" rel="noreferrer">source</a><!--]--></span></details><details class="jldocstring custom-block" open><summary><a id="Sindbad.ML.scaleToBounds-Tuple{Any, Any, Any}" href="#Sindbad.ML.scaleToBounds-Tuple{Any, Any, Any}"><span class="jlbinding">Sindbad.ML.scaleToBounds</span></a> <span class="VPBadge info jlObjectType jlMethod"><!--[-->Method<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">scaleToBounds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, lo_b, up_b)</span></span></code></pre></div><p>Scales values in the [0,1] interval to some given lower <code>lo_b</code> and upper <code>up_b</code> bounds.</p><p><strong>Arguments</strong></p><ul><li><p><code>x</code>: vector array</p></li><li><p><code>lo_b</code>: lower bound</p></li><li><p><code>up_b</code>: upper bound</p></li></ul><span class="VPBadge info source-link"><!--[--><a href="https://github.com/EarthyScience/SINDBAD/blob/dd7b54daca03cc8306990131fe1826dd49edf62d/src/ML/utilsML.jl#L24-L33" target="_blank" rel="noreferrer">source</a><!--]--></span></details></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/SINDBAD/previews/PR39/pages/code/data.html" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa> + Data</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/SINDBAD/previews/PR39/pages/code/optimization.html" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa> + Optimization</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860><a href="https://www.bgc-jena.mpg.de/en" target="_blank"><img src="/logo_mpi_grey.png" class="footer-logo" alt="MPI Logo"/></a></p><p class="copyright" data-v-c970a860>© Copyright 2025 <strong> SINDBAD Development Team</strong></span></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"CiLxkg33\",\"pages_about_citation.md\":\"DApilf3t\",\"pages_about_contact.md\":\"DlKIdoKx\",\"pages_about_license.md\":\"DuXy5jMx\",\"pages_about_publications.md\":\"BaaJ3pOb\",\"pages_about_support.md\":\"CPNplUB2\",\"pages_about_team.md\":\"CT0mvS63\",\"pages_code_data.md\":\"DHuGsrSZ\",\"pages_code_metrics.md\":\"BgyAeRIe\",\"pages_code_ml.md\":\"OXzimdUy\",\"pages_code_models.md\":\"DqOaE7d8\",\"pages_code_optimization.md\":\"GDxQqYg1\",\"pages_code_overview.md\":\"KhofrIU8\",\"pages_code_setup.md\":\"Cfty5pPL\",\"pages_code_sindbad.md\":\"e1e-CROc\",\"pages_code_tem.md\":\"DORqQQah\",\"pages_code_types.md\":\"F1s5_kTk\",\"pages_code_utilities.md\":\"Cc5FfuOz\",\"pages_concept_experiment.md\":\"DcwA_kdg\",\"pages_concept_info.md\":\"B-RHBChe\",\"pages_concept_land.md\":\"D4Css-VD\",\"pages_concept_overview.md\":\"UZauiJDF\",\"pages_concept_tem.md\":\"BmmWjhJY\",\"pages_develop_array_handling.md\":\"Bd4xKHGn\",\"pages_develop_conventions.md\":\"BR7yrDy7\",\"pages_develop_cost_function.md\":\"DzSZk3FD\",\"pages_develop_cost_metrics.md\":\"CcGJ9ZMM\",\"pages_develop_experiments.md\":\"ztr5WERd\",\"pages_develop_helpers.md\":\"Cmgro6_Z\",\"pages_develop_how_to_doc.md\":\"BBIoLH0B\",\"pages_develop_hybrid_modeling.md\":\"B7ylhUsR\",\"pages_develop_install.md\":\"MQ20ytb2\",\"pages_develop_land_utils.md\":\"BAOGyP5p\",\"pages_develop_model_approach.md\":\"CjJEWh5a\",\"pages_develop_optimization_method.md\":\"jEK27_ki\",\"pages_develop_overview.md\":\"CNW2gKX8\",\"pages_develop_sindbad_outputs.md\":\"HcAnCcrN\",\"pages_develop_sindbad_types.md\":\"Bs-tXslR\",\"pages_develop_spinup.md\":\"BkRTpmt6\",\"pages_settings_experiment.md\":\"CtYGEpDW\",\"pages_settings_forcing.md\":\"BAkKS5VN\",\"pages_settings_model_structure.md\":\"BDJIT1dF\",\"pages_settings_optimization.md\":\"Bn63rAmg\",\"pages_settings_overview.md\":\"CCwb_Bzg\",\"pages_settings_parameters.md\":\"BvEVw7BC\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"SINDBAD\",\"description\":\"A model-data integration framework for terrestrial ecosystem processes\",\"base\":\"/SINDBAD/previews/PR39/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"logo\":{\"src\":\"/sindbad_logo.png\",\"width\":24,\"height\":24},\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"nav\":[{\"text\":\"Concept\",\"items\":[{\"text\":\"SINDBAD\",\"link\":\"/pages/concept/overview\"},{\"text\":\"Experiment\",\"link\":\"/pages/concept/experiment\"},{\"text\":\"TEM\",\"link\":\"/pages/concept/TEM\"},{\"text\":\"info\",\"link\":\"/pages/concept/info\"},{\"text\":\"land\",\"link\":\"/pages/concept/land\"}]},{\"text\":\"Settings\",\"items\":[{\"text\":\"Overview\",\"link\":\"/pages/settings/overview\"},{\"text\":\"Experiments\",\"link\":\"/pages/settings/experiment\"},{\"text\":\"Forcing\",\"link\":\"/pages/settings/forcing\"},{\"text\":\"Models\",\"link\":\"/pages/settings/model_structure\"},{\"text\":\"Optimization\",\"link\":\"/pages/settings/optimization\"},{\"text\":\"Parameters\",\"link\":\"/pages/settings/parameters\"}]},{\"text\":\"Code\",\"items\":[{\"text\":\"Sindbad\",\"link\":\"/pages/code/overview\"},{\"text\":\" + Core\",\"link\":\"/pages/code/sindbad\"},{\"text\":\"   ++ Models\",\"link\":\"/pages/code/models\"},{\"text\":\"   ++ Types\",\"link\":\"/pages/code/types\"},{\"text\":\"   ++ Utilities\",\"link\":\"/pages/code/utilities\"},{\"text\":\"   ++ Metrics\",\"link\":\"/pages/code/metrics\"},{\"text\":\" + Data\",\"link\":\"/pages/code/data\"},{\"text\":\" + ML\",\"link\":\"/pages/code/ml\"},{\"text\":\" + Optimization\",\"link\":\"/pages/code/optimization\"},{\"text\":\" + Setup\",\"link\":\"/pages/code/setup\"},{\"text\":\" + TEM\",\"link\":\"/pages/code/tem\"}]},{\"text\":\"Develop\",\"items\":[{\"text\":\"Overview\",\"link\":\"/pages/develop/overview\"},{\"text\":\"Install\",\"link\":\"/pages/develop/install\"},{\"text\":\"Modeling Convention\",\"link\":\"/pages/develop/conventions\"},{\"text\":\"Model/Approach\",\"link\":\"/pages/develop/model_approach\"},{\"text\":\"Sindbad Types\",\"link\":\"/pages/develop/sindbad_types\"},{\"text\":\"Array Handling\",\"link\":\"/pages/develop/array_handling\"},{\"text\":\"Land Utils\",\"link\":\"/pages/develop/land_utils\"},{\"text\":\"Experiments\",\"link\":\"/pages/develop/experiments\"},{\"text\":\"Experiment Outputs\",\"link\":\"/pages/develop/sindbad_outputs\"},{\"text\":\"Spinup\",\"link\":\"/pages/develop/spinup\"},{\"text\":\"Hybrid ML\",\"link\":\"/pages/develop/hybrid_modeling\"},{\"text\":\"Optimization Methods\",\"link\":\"/pages/develop/optimization_method\"},{\"text\":\"Cost Metrics\",\"link\":\"/pages/develop/cost_metrics\"},{\"text\":\"Cost Function\",\"link\":\"/pages/develop/cost_function\"},{\"text\":\"Documentation\",\"link\":\"/pages/develop/how_to_doc\"},{\"text\":\"Useful Helpers\",\"link\":\"/pages/develop/helpers\"}]},{\"text\":\"About\",\"items\":[{\"text\":\"Contact\",\"link\":\"/pages/about/contact\"},{\"text\":\"License\",\"link\":\"/pages/about/license\"},{\"text\":\"Publications\",\"link\":\"/pages/about/publications\"},{\"text\":\"Support\",\"link\":\"/pages/about/support\"},{\"text\":\"Team\",\"link\":\"/pages/about/team\"}]},{\"component\":\"VersionPicker\"}],\"sidebar\":[{\"text\":\"Concept\",\"items\":[{\"text\":\"SINDBAD\",\"link\":\"/pages/concept/overview\"},{\"text\":\"Experiment\",\"link\":\"/pages/concept/experiment\"},{\"text\":\"TEM\",\"link\":\"/pages/concept/TEM\"},{\"text\":\"info\",\"link\":\"/pages/concept/info\"},{\"text\":\"land\",\"link\":\"/pages/concept/land\"}]},{\"text\":\"Develop\",\"items\":[{\"text\":\"Overview\",\"link\":\"/pages/develop/overview\"},{\"text\":\"Install\",\"link\":\"/pages/develop/install\"},{\"text\":\"Modeling Convention\",\"link\":\"/pages/develop/conventions\"},{\"text\":\"Model/Approach\",\"link\":\"/pages/develop/model_approach\"},{\"text\":\"Sindbad Types\",\"link\":\"/pages/develop/sindbad_types\"},{\"text\":\"Array Handling\",\"link\":\"/pages/develop/array_handling\"},{\"text\":\"Land Utils\",\"link\":\"/pages/develop/land_utils\"},{\"text\":\"Experiments\",\"link\":\"/pages/develop/experiments\"},{\"text\":\"Experiment Outputs\",\"link\":\"/pages/develop/sindbad_outputs\"},{\"text\":\"Spinup\",\"link\":\"/pages/develop/spinup\"},{\"text\":\"Hybrid ML\",\"link\":\"/pages/develop/hybrid_modeling\"},{\"text\":\"Optimization Methods\",\"link\":\"/pages/develop/optimization_method\"},{\"text\":\"Cost Metrics\",\"link\":\"/pages/develop/cost_metrics\"},{\"text\":\"Cost Function\",\"link\":\"/pages/develop/cost_function\"},{\"text\":\"Documentation\",\"link\":\"/pages/develop/how_to_doc\"},{\"text\":\"Useful Helpers\",\"link\":\"/pages/develop/helpers\"}]},{\"text\":\"Settings\",\"items\":[{\"text\":\"Overview\",\"link\":\"/pages/settings/overview\"},{\"text\":\"Experiments\",\"link\":\"/pages/settings/experiment\"},{\"text\":\"Forcing\",\"link\":\"/pages/settings/forcing\"},{\"text\":\"Models\",\"link\":\"/pages/settings/model_structure\"},{\"text\":\"Optimization\",\"link\":\"/pages/settings/optimization\"},{\"text\":\"Parameters\",\"link\":\"/pages/settings/parameters\"}]},{\"text\":\"Code\",\"collapsed\":true,\"items\":[{\"text\":\"Sindbad\",\"link\":\"/pages/code/overview\"},{\"text\":\" + Core\",\"link\":\"/pages/code/sindbad\"},{\"text\":\"   ++ Models\",\"link\":\"/pages/code/models\"},{\"text\":\"   ++ Types\",\"link\":\"/pages/code/types\"},{\"text\":\"   ++ Utilities\",\"link\":\"/pages/code/utilities\"},{\"text\":\"   ++ Metrics\",\"link\":\"/pages/code/metrics\"},{\"text\":\" + Data\",\"link\":\"/pages/code/data\"},{\"text\":\" + ML\",\"link\":\"/pages/code/ml\"},{\"text\":\" + Optimization\",\"link\":\"/pages/code/optimization\"},{\"text\":\" + Setup\",\"link\":\"/pages/code/setup\"},{\"text\":\" + TEM\",\"link\":\"/pages/code/tem\"}]},{\"text\":\"About\",\"items\":[{\"text\":\"Contact\",\"link\":\"/pages/about/contact\"},{\"text\":\"License\",\"link\":\"/pages/about/license\"},{\"text\":\"Publications\",\"link\":\"/pages/about/publications\"},{\"text\":\"Support\",\"link\":\"/pages/about/support\"},{\"text\":\"Team\",\"link\":\"/pages/about/team\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/EarthyScience/SINDBAD\",\"ariaLabel\":\"repo address\"}],\"footer\":{\"message\":\"<a href=\\\"https://www.bgc-jena.mpg.de/en\\\" target=\\\"_blank\\\"><img src=\\\"/logo_mpi_grey.png\\\" class=\\\"footer-logo\\\" alt=\\\"MPI Logo\\\"/></a>\",\"copyright\":\"© Copyright 2025 <strong> SINDBAD Development Team</strong></span>\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>